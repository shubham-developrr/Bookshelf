<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Sync Test</title>
</head>
<body>
    <h1>Cloud Sync Test Page</h1>
    <p>Open console and run the test</p>
    
    <button onclick="testCloudSync()">Test Cloud Sync</button>
    <div id="results"></div>

    <script>
        // Import and test the UnifiedBookAdapter
        async function testCloudSync() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing cloud sync...</p>';
            
            try {
                // Test data matching your actual book
                const testBook = "physics";
                const testChapter = "wht we know";
                const testNotes = [
                    {
                        id: "sync_test_" + Date.now(),
                        content: "TEST NOTE: Cloud sync verification " + new Date().toLocaleString(),
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        color: "yellow"
                    }
                ];
                
                console.log("üß™ Testing UnifiedBookAdapter cloud sync...");
                console.log("Book:", testBook, "Chapter:", testChapter);
                console.log("Test data:", testNotes);
                
                // Simulate what the template managers do
                // 1. Save to localStorage first (immediate)
                const baseKey = `NOTES_${testBook.replace(/\s+/g, '_')}_${testChapter.replace(/\s+/g, '_')}`;
                localStorage.setItem(baseKey, JSON.stringify(testNotes));
                console.log("‚úÖ Step 1: Saved to localStorage with key:", baseKey);
                
                // 2. The UnifiedBookAdapter should have queued cloud sync
                // Let's check after a few seconds
                results.innerHTML = `
                    <p>‚úÖ Test notes saved to localStorage</p>
                    <p>‚è≥ Waiting for cloud sync (should happen automatically via UnifiedBookAdapter)...</p>
                    <p><strong>Key:</strong> ${baseKey}</p>
                    <p><strong>Data:</strong> ${JSON.stringify(testNotes, null, 2)}</p>
                `;
                
                setTimeout(() => {
                    results.innerHTML += `
                        <p>üîç <strong>Cloud sync should be complete now!</strong></p>
                        <p>Check Supabase database for content_data changes</p>
                        <p>Expected: physics book should have "${baseKey}" in content_data</p>
                    `;
                }, 3000);
                
            } catch (error) {
                console.error("‚ùå Test failed:", error);
                results.innerHTML = `<p style="color: red;">‚ùå Test failed: ${error.message}</p>`;
            }
        }
        
        window.testCloudSync = testCloudSync;
    </script>
</body>
</html>
